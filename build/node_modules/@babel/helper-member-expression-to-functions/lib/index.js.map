{"version":3,"sources":["../../../../../node_modules/@babel/helper-member-expression-to-functions/lib/index.js"],"names":["Object","defineProperty","exports","value","default","memberExpressionToFunctions","t","data","_interopRequireWildcard","require","obj","__esModule","newObj","key","prototype","hasOwnProperty","call","desc","getOwnPropertyDescriptor","get","set","AssignmentMemoiser","constructor","_map","WeakMap","has","record","count","assignmentExpression","handle","memoise","member","node","parent","parentPath","isUpdateExpression","argument","operator","prefix","binaryExpression","unaryExpression","numericLiteral","replaceWith","scope","ref","generateUidIdentifierBasedOnNode","push","id","left","cloneNode","sequenceExpression","isAssignmentExpression","right","slice","isCallExpression","callee","arguments","args","path","visitor","state","traverse","assign","memoiser"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = memberExpressionToFunctions;\n\nfunction t() {\n  const data = _interopRequireWildcard(require(\"@babel/types\"));\n\n  t = function () {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nclass AssignmentMemoiser {\n  constructor() {\n    this._map = new WeakMap();\n  }\n\n  has(key) {\n    return this._map.has(key);\n  }\n\n  get(key) {\n    if (!this.has(key)) return;\n\n    const record = this._map.get(key);\n\n    const {\n      value\n    } = record;\n    record.count--;\n\n    if (record.count === 0) {\n      return t().assignmentExpression(\"=\", value, key);\n    }\n\n    return value;\n  }\n\n  set(key, value, count) {\n    return this._map.set(key, {\n      count,\n      value\n    });\n  }\n\n}\n\nconst handle = {\n  memoise() {},\n\n  handle(member) {\n    const {\n      node,\n      parent,\n      parentPath\n    } = member;\n\n    if (parentPath.isUpdateExpression({\n      argument: node\n    })) {\n      const {\n        operator,\n        prefix\n      } = parent;\n      this.memoise(member, 2);\n      const value = t().binaryExpression(operator[0], t().unaryExpression(\"+\", this.get(member)), t().numericLiteral(1));\n\n      if (prefix) {\n        parentPath.replaceWith(this.set(member, value));\n      } else {\n        const {\n          scope\n        } = member;\n        const ref = scope.generateUidIdentifierBasedOnNode(node);\n        scope.push({\n          id: ref\n        });\n        value.left = t().assignmentExpression(\"=\", t().cloneNode(ref), value.left);\n        parentPath.replaceWith(t().sequenceExpression([this.set(member, value), t().cloneNode(ref)]));\n      }\n\n      return;\n    }\n\n    if (parentPath.isAssignmentExpression({\n      left: node\n    })) {\n      const {\n        operator,\n        right\n      } = parent;\n      let value = right;\n\n      if (operator !== \"=\") {\n        this.memoise(member, 2);\n        value = t().binaryExpression(operator.slice(0, -1), this.get(member), value);\n      }\n\n      parentPath.replaceWith(this.set(member, value));\n      return;\n    }\n\n    if (parentPath.isCallExpression({\n      callee: node\n    })) {\n      const {\n        arguments: args\n      } = parent;\n      parentPath.replaceWith(this.call(member, args));\n      return;\n    }\n\n    member.replaceWith(this.get(member));\n  }\n\n};\n\nfunction memberExpressionToFunctions(path, visitor, state) {\n  path.traverse(visitor, Object.assign({}, handle, state, {\n    memoiser: new AssignmentMemoiser()\n  }));\n}"],"file":"index.js"}