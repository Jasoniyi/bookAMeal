{"version":3,"sources":["../../../../../../node_modules/@babel/core/lib/config/caching.js"],"names":["Object","defineProperty","exports","value","makeStrongCache","makeWeakCache","assertSimpleType","handler","makeCachedFunction","Map","WeakMap","callCache","cachedFunction","arg","data","cachedValue","get","_ref","valid","cache","CacheConfigurator","configured","forever","deactivate","mode","set","validator","push","constructor","_active","_never","_forever","_invalidate","_configured","_pairs","_data","simple","makeSimpleConfigurator","Error","never","using","key","invalidate","pairs","every","fn","cacheFn","val","cb"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.makeStrongCache = makeStrongCache;\nexports.makeWeakCache = makeWeakCache;\nexports.assertSimpleType = assertSimpleType;\n\nfunction makeStrongCache(handler) {\n  return makeCachedFunction(new Map(), handler);\n}\n\nfunction makeWeakCache(handler) {\n  return makeCachedFunction(new WeakMap(), handler);\n}\n\nfunction makeCachedFunction(callCache, handler) {\n  return function cachedFunction(arg, data) {\n    let cachedValue = callCache.get(arg);\n\n    if (cachedValue) {\n      for (const _ref of cachedValue) {\n        const {\n          value,\n          valid\n        } = _ref;\n        if (valid(data)) return value;\n      }\n    }\n\n    const cache = new CacheConfigurator(data);\n    const value = handler(arg, cache);\n    if (!cache.configured()) cache.forever();\n    cache.deactivate();\n\n    switch (cache.mode()) {\n      case \"forever\":\n        cachedValue = [{\n          value,\n          valid: () => true\n        }];\n        callCache.set(arg, cachedValue);\n        break;\n\n      case \"invalidate\":\n        cachedValue = [{\n          value,\n          valid: cache.validator()\n        }];\n        callCache.set(arg, cachedValue);\n        break;\n\n      case \"valid\":\n        if (cachedValue) {\n          cachedValue.push({\n            value,\n            valid: cache.validator()\n          });\n        } else {\n          cachedValue = [{\n            value,\n            valid: cache.validator()\n          }];\n          callCache.set(arg, cachedValue);\n        }\n\n    }\n\n    return value;\n  };\n}\n\nclass CacheConfigurator {\n  constructor(data) {\n    this._active = true;\n    this._never = false;\n    this._forever = false;\n    this._invalidate = false;\n    this._configured = false;\n    this._pairs = [];\n    this._data = data;\n  }\n\n  simple() {\n    return makeSimpleConfigurator(this);\n  }\n\n  mode() {\n    if (this._never) return \"never\";\n    if (this._forever) return \"forever\";\n    if (this._invalidate) return \"invalidate\";\n    return \"valid\";\n  }\n\n  forever() {\n    if (!this._active) {\n      throw new Error(\"Cannot change caching after evaluation has completed.\");\n    }\n\n    if (this._never) {\n      throw new Error(\"Caching has already been configured with .never()\");\n    }\n\n    this._forever = true;\n    this._configured = true;\n  }\n\n  never() {\n    if (!this._active) {\n      throw new Error(\"Cannot change caching after evaluation has completed.\");\n    }\n\n    if (this._forever) {\n      throw new Error(\"Caching has already been configured with .forever()\");\n    }\n\n    this._never = true;\n    this._configured = true;\n  }\n\n  using(handler) {\n    if (!this._active) {\n      throw new Error(\"Cannot change caching after evaluation has completed.\");\n    }\n\n    if (this._never || this._forever) {\n      throw new Error(\"Caching has already been configured with .never or .forever()\");\n    }\n\n    this._configured = true;\n    const key = handler(this._data);\n\n    this._pairs.push([key, handler]);\n\n    return key;\n  }\n\n  invalidate(handler) {\n    if (!this._active) {\n      throw new Error(\"Cannot change caching after evaluation has completed.\");\n    }\n\n    if (this._never || this._forever) {\n      throw new Error(\"Caching has already been configured with .never or .forever()\");\n    }\n\n    this._invalidate = true;\n    this._configured = true;\n    const key = handler(this._data);\n\n    this._pairs.push([key, handler]);\n\n    return key;\n  }\n\n  validator() {\n    const pairs = this._pairs;\n    return data => pairs.every(([key, fn]) => key === fn(data));\n  }\n\n  deactivate() {\n    this._active = false;\n  }\n\n  configured() {\n    return this._configured;\n  }\n\n}\n\nfunction makeSimpleConfigurator(cache) {\n  function cacheFn(val) {\n    if (typeof val === \"boolean\") {\n      if (val) cache.forever();else cache.never();\n      return;\n    }\n\n    return cache.using(() => assertSimpleType(val()));\n  }\n\n  cacheFn.forever = () => cache.forever();\n\n  cacheFn.never = () => cache.never();\n\n  cacheFn.using = cb => cache.using(() => assertSimpleType(cb()));\n\n  cacheFn.invalidate = cb => cache.invalidate(() => assertSimpleType(cb()));\n\n  return cacheFn;\n}\n\nfunction assertSimpleType(value) {\n  if (value != null && typeof value !== \"string\" && typeof value !== \"boolean\" && typeof value !== \"number\") {\n    throw new Error(\"Cache keys must be either string, boolean, number, null, or undefined.\");\n  }\n\n  return value;\n}"],"file":"caching.js"}